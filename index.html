<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Grabados Locohones</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 16px; margin: 0; background-color: #f5f5f5; }
    .container { max-width: 100%; margin: auto; background: #fff; padding: 16px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    .preview { position: relative; margin-top: 16px; font-size: 34px; font-weight: bold; background-color: white; height: 160px; width: 100%;
      display: flex; justify-content: center; align-items: center; text-align: center; border-radius: 0; transition: transform 0.3s ease-in-out; }
    .mirror { transform: scaleX(-1); }
    .preview-frame { width: 177px; height: 177px; border: 2px dashed red; position: relative; display: flex; justify-content: center;
      align-items: center; pointer-events: none; }
    .contenido-preview { display: flex; flex-direction: column; align-items: center; pointer-events: auto; transition: transform 0.2s ease; }
    .no-print { margin-top: 20px; text-align: center; color: gray; font-size: 14px; }
    button { width: 100%; padding: 12px; font-size: 18px; background-color: #333; color: white; border: none; border-radius: 8px; cursor: pointer; margin-top: 10px; }
    input, select { padding: 12px; width: 100%; margin-bottom: 15px; font-size: 18px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
    @media print {
      @page { size: 57mm auto; margin: 0; }
      html, body { overflow: hidden; }
      body * { visibility: hidden; }
      #impresionesContainer, #impresionesContainer * { visibility: visible; }
      .preview-frame { border: none !important; }
      .copia { page-break-after: always; }
      .no-print { display: none !important; }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Inputs y controles -->
    <label for="patente">Patente del Vehículo:</label>
    <input type="text" id="patente" placeholder="Ej: ZX2942" maxlength="6" oninput="this.value = this.value.toUpperCase(); actualizarVistaPrevia();" />

    <label for="logo">Marca del Vehículo (opcional):</label>
    <select id="logo" onchange="actualizarVistaPrevia()">
      <option value="">-- Sin Marca --</option>
      <option value="audi.png">Audi</option>
      <option value="bmw.png">BMW</option>
      <!-- Aquí seguirían las demás marcas -->
    </select>

    <label><input type="checkbox" id="negritaPatente" onchange="actualizarVistaPrevia()" /> Texto en Negrita</label>

    <label for="tamanoLogo">Tamaño del Logo:</label>
    <input type="range" id="tamanoLogo" min="20" max="100" value="60" oninput="actualizarVistaPrevia()" />

    <label for="posicionVertical">Posición vertical del bloque:</label>
    <input type="range" id="posicionVertical" min="-50" max="50" value="0" oninput="actualizarVistaPrevia()" />

    <label for="espacioLogoPatente">Espacio entre logo y patente:</label>
    <input type="range" id="espacioLogoPatente" min="0" max="50" value="4" oninput="actualizarVistaPrevia()" />

    <!-- Botones -->
    <button onclick="generarPlantilla()">Generar Plantilla</button>
    <button onclick="solicitarCantidadEImprimir()">Imprimir Copias</button>
    <button id="btnEspejo" onclick="alternarModoEspejo()">Desactivar Espejo</button>

    <!-- Vista previa -->
    <div class="preview mirror" id="vistaPrevia" style="display:none;">
      <div class="preview-frame">
        <div class="contenido-preview" id="contenidoPreview"></div>
      </div>
    </div>

    <!-- Contenedor para impresiones -->
    <div id="impresionesContainer" style="display:none;"></div>

    <!-- Texto de versión no imprimible -->
    <div class="no-print">
      Versión 1.2.
    </div>
  </div>

  <script>
    function generarPlantilla() {
      const vistaPrevia = document.getElementById('vistaPrevia');
      vistaPrevia.style.display = 'flex';
      actualizarVistaPrevia();
    }

    function actualizarVistaPrevia() {
      const patente = document.getElementById('patente').value.trim().toUpperCase();
      const logo = document.getElementById('logo').value;
      const negrita = document.getElementById('negritaPatente').checked;
      const tamanoLogo = document.getElementById('tamanoLogo').value;
      const posicionVertical = document.getElementById('posicionVertical').value;
      const espacioLogoPatente = document.getElementById('espacioLogoPatente').value;
      const contenidoPreview = document.getElementById('contenidoPreview');

      if (patente.length !== 6) {
        contenidoPreview.innerHTML = '<div style="color:red">Debe ingresar 6 caracteres</div>';
        return;
      }

      const estiloTexto = `font-weight: ${negrita ? 'bold' : 'normal'}; font-size:34px;`;
      const desplazamiento = `translateY(${posicionVertical}px)`;
      const margenInferiorLogo = `${espacioLogoPatente}px`;

      contenidoPreview.style.transform = desplazamiento;

      contenidoPreview.innerHTML = logo
        ? `<img src="./logos/${logo}" alt="logo" style="height:${tamanoLogo}px; margin-bottom:${margenInferiorLogo};" onerror="this.style.display='none';">
           <div style="${estiloTexto}">${patente}</div>`
        : `<div style="${estiloTexto}">${patente}</div>`;
    }

    function alternarModoEspejo() {
      const vistaPrevia = document.getElementById('vistaPrevia');
      const boton = document.getElementById('btnEspejo');
      vistaPrevia.classList.toggle('mirror');
      boton.textContent = vistaPrevia.classList.contains('mirror') ? 'Desactivar Espejo' : 'Activar Espejo';
    }

    function solicitarCantidadEImprimir() {
      const cantidad = prompt("¿Cuántas copias deseas imprimir?");
      if (cantidad && !isNaN(cantidad) && parseInt(cantidad) > 0) {
        imprimirCopias(parseInt(cantidad));
      } else {
        alert("Por favor ingresa un número válido.");
      }
    }

    function imprimirCopias(cantidad) {
      const container = document.getElementById('impresionesContainer');
      container.innerHTML = '';
      container.style.display = 'block';

      const vistaPrevia = document.getElementById('vistaPrevia');
      const contenidoActual = document.getElementById('contenidoPreview').innerHTML;
      const esEspejado = vistaPrevia.classList.contains('mirror');

      for (let i = 0; i < cantidad; i++) {
        const copia = document.createElement('div');
        copia.className = 'copia';
        copia.innerHTML = `
          <div class="preview-frame">
            <div class="contenido-preview ${esEspejado ? 'mirror' : ''}" style="display:flex; flex-direction:column; align-items:center;">
              ${contenidoActual}
            </div>
          </div>`;
        container.appendChild(copia);
      }

      window.print();
      container.innerHTML = '';
      container.style.display = 'none';
    }
  </script>
</body>
</html>
